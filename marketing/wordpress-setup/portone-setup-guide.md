# 💳 포트원 결제 연동 가이드

WooCommerce + 포트원(구 아임포트)을 사용하여 ACF CSS Manager 결제를 설정합니다.

---

## 📋 사전 요구사항

- ✅ WordPress + WooCommerce 설치됨
- ✅ j-j-labs.com 도메인
- ✅ SSL 인증서 (필수)
- ✅ 사업자등록증 (PG사 계약 시 필요)

---

## 🚀 Step 1: 포트원 계정 생성

### 1.1 회원가입

1. https://admin.portone.io 접속
2. **회원가입** 클릭
3. 이메일 인증 완료

### 1.2 가맹점 정보 입력

1. 로그인 후 **가맹점 설정** 이동
2. 사업자 정보 입력:
   - 상호명: J&J Labs
   - 사업자등록번호: [입력]
   - 대표자명: [입력]
   - 사업장 주소: [입력]

### 1.3 API Key 발급

1. **결제연동** > **연동 정보** 이동
2. **API Keys** 확인:
   - `가맹점 식별코드` (imp_xxxxx)
   - `REST API Key`
   - `REST API Secret`

---

## 💳 Step 2: PG사 계약

### 추천 PG사 조합

| PG사 | 용도 | 특징 |
|------|------|------|
| **토스페이먼츠** | 메인 카드결제 | 빠른 정산, 좋은 UX |
| **KG이니시스** | 카드/계좌이체 | 안정적, 다양한 수단 |
| **나이스페이먼츠** | 해외카드 | 해외 구매자 대응 |

### PG사 연동

1. 포트원 관리자에서 **PG 설정** 이동
2. 원하는 PG사 선택
3. **테스트 환경** 먼저 연동
4. PG사 심사 완료 후 **실환경** 전환

---

## 🔌 Step 3: WooCommerce 플러그인 설치

### 3.1 플러그인 설치

1. **플러그인 > 새로 추가**
2. "포트원" 또는 "iamport" 검색
3. **WooCommerce 포트원 결제** 플러그인 설치
4. **활성화**

### 3.2 플러그인 설정

1. **WooCommerce > 설정 > 결제** 이동
2. **포트원** 탭 클릭
3. 다음 정보 입력:

```
가맹점 식별코드: imp_xxxxx
REST API Key: [포트원에서 복사]
REST API Secret: [포트원에서 복사]
```

4. **변경사항 저장**

---

## 💰 Step 4: 결제 수단 설정

### 4.1 신용카드 결제

```
설정 > WooCommerce > 결제 > 신용카드

✅ 활성화
제목: 신용카드
설명: 모든 신용/체크카드로 결제 가능합니다.
```

### 4.2 간편결제 (네이버페이, 카카오페이)

```
설정 > WooCommerce > 결제 > 간편결제

✅ 네이버페이 활성화
✅ 카카오페이 활성화
✅ 토스페이 활성화
```

> 💡 각 간편결제는 별도 가맹점 계약이 필요할 수 있습니다.

### 4.3 가상계좌

```
설정 > WooCommerce > 결제 > 가상계좌

✅ 활성화
유효기간: 7일
자동 주문 취소: 활성화
```

---

## 🧪 Step 5: 테스트 결제

### 5.1 테스트 모드 활성화

1. 포트원 관리자에서 **테스트 환경** 선택
2. WooCommerce에서 테스트 결제 진행

### 5.2 테스트 카드 정보

```
카드번호: 4000-0000-0000-0002
유효기간: 아무 미래 날짜
CVC: 아무 3자리
```

### 5.3 확인 사항

- [x] 결제 페이지 정상 표시
- [x] 결제 완료 후 주문 상태 변경
- [x] 라이센스 자동 발급 (Neural Link 연동 시)
- [x] 확인 이메일 발송

---

## 🔗 Step 6: Neural Link 연동

WooCommerce 주문 완료 시 자동으로 라이센스를 발급합니다.

### 6.1 ACF CSS Woo License 플러그인 설치

```
marketing/wordpress-plugins/acf-css-woo-license/ → ZIP 압축 → 업로드
```

### 6.2 Neural Link 연결 설정

1. **WooCommerce > ACF CSS 라이센스** 이동
2. Neural Link URL 입력
3. API Key 입력
4. **연결 테스트** 버튼 클릭

### 6.3 상품별 라이센스 설정

각 ACF CSS 상품 편집 페이지에서:

1. **ACF CSS 라이센스 상품** 체크
2. **라이센스 에디션** 선택 (Free/Basic/Premium/Partner)
3. **라이센스 기간** 입력 (365 = 1년)
4. **사이트 수 제한** 입력 (0 = 무제한)

---

## 📊 Step 7: 정산 설정

### 7.1 정산 계좌 등록

1. 포트원 관리자 > **정산 관리** > **정산 계좌**
2. 계좌 정보 입력
3. 본인 인증 완료

### 7.2 정산 주기

| PG사 | 정산 주기 |
|------|----------|
| 토스페이먼츠 | D+1 (다음 영업일) |
| KG이니시스 | D+3 ~ D+5 |
| 나이스페이먼츠 | D+3 |

---

## 🔒 Step 8: 보안 설정

### 8.1 Webhook 설정

1. 포트원 관리자 > **결제연동** > **Webhook**
2. Webhook URL 입력:
   ```
   https://j-j-labs.com/wc-api/iamport/
   ```
3. 알림 받을 이벤트 선택

### 8.2 IP 화이트리스트

포트원 서버 IP를 방화벽에서 허용:
```
52.78.xxx.xxx (포트원 문서 참조)
```

---

## 🌍 Step 9: 해외 결제 (선택)

해외 고객을 위한 PayPal/Stripe 추가 연동:

### PayPal

1. WooCommerce > 결제 > PayPal
2. PayPal Business 계정 연결
3. 달러(USD) 결제 활성화

### Stripe

1. 포트원에서 Stripe 연동
2. 또는 WooCommerce Stripe Gateway 플러그인 별도 사용

---

## ❓ FAQ

### Q: 테스트 결제가 실패해요

- SSL 인증서 확인
- API Key 오타 확인
- PG사 테스트 환경 활성화 확인

### Q: 실결제 전환은 언제 해야 하나요?

- 모든 테스트 완료 후
- PG사 심사 완료 후
- 포트원 관리자에서 "실환경" 선택

### Q: 환불 처리는 어떻게 하나요?

1. WooCommerce 주문 상세에서 **환불** 클릭
2. 금액 입력 후 **환불 처리**
3. 포트원을 통해 자동 환불 처리됨

### Q: 수수료는 얼마인가요?

| 결제 수단 | 수수료 (대략) |
|----------|--------------|
| 신용카드 | 2.5-3.5% |
| 간편결제 | 3.0-3.5% |
| 계좌이체 | 1.5-2.0% |

> 수수료는 PG사, 매출 규모, 계약 조건에 따라 다릅니다.

---

## 📞 지원

- 포트원 고객센터: help@portone.io
- 포트원 문서: https://developers.portone.io/
- J&J Labs 기술지원: support@j-j-labs.com

---

다음 단계: [Brevo 이메일 자동화 설정](/setup/brevo/) →

