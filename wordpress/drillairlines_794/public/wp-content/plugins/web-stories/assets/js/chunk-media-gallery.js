"use strict";(globalThis.webpackChunkweb_stories_wp=globalThis.webpackChunkweb_stories_wp||[]).push([[7748],{97581:(e,t,n)=>{n.r(t),n.d(t,{default:()=>ot});var o=n(96540),a=n(21728),r=n(64746),i=n(4032),s=n(59711),l=n(72240),c=n(5556),d=n.n(c),u=n(31357),m=n(83278),p=n(89476),h=n(20781),f=n(55815),g=n(8378),y=n(41798),b=n(67340),_=n(37699),E=n(66189),w=n(30119),C=n(7532),x=n(54385),v=n(67537),k=n(7927),I=n(19637),T=n(55313),M=n(258),S=n(75453),D=n(70406),R=n(10717);function DeleteDialog(e){const t=(0,a.c)(22),{mediaId:n,type:i,onClose:s}=e,{actions:l}=(0,M.useAPI)(),{deleteMedia:c}=l,{showSnackbar:d}=(0,k.useSnackbar)(),{deleteMediaElement:u}=(0,S.useLocalMedia)(j),{deleteElementsByResourceId:p}=(0,D.useStory)(P);let h,f;t[0]!==p||t[1]!==c||t[2]!==u||t[3]!==n||t[4]!==s||t[5]!==d?(h=async()=>{s();try{await c(n),u({id:n}),p({id:n})}catch(e){const t=e;(0,v.trackError)("local_media_deletion",t.message),d({message:(0,m.__)("Failed to delete media item.","web-stories"),dismissible:!0})}},f=[c,u,p,n,s,d],t[0]=p,t[1]=c,t[2]=u,t[3]=n,t[4]=s,t[5]=d,t[6]=h,t[7]=f):(h=t[6],f=t[7]);const g=(0,r.useCallback)(h,f);let y;t[8]===Symbol.for("react.memo_cache_sentinel")?(y=(0,m.__)("Delete Image?","web-stories"),t[8]=y):y=t[8];const b=y;let _;t[9]===Symbol.for("react.memo_cache_sentinel")?(_=(0,m.__)("Delete Video?","web-stories"),t[9]=_):_=t[9];const E=_;let w;t[10]===Symbol.for("react.memo_cache_sentinel")?(w=(0,m.__)("You are about to permanently delete this image from your site. The image will appear broken in any content that uses it.","web-stories"),t[10]=w):w=t[10];const C=w;let x;t[11]===Symbol.for("react.memo_cache_sentinel")?(x=(0,m.__)("You are about to permanently delete this video from your site. The video will appear broken in any content that uses it.","web-stories"),t[11]=x):x=t[11];const q=x,N="image"===i?b:E;let O,B;t[12]===Symbol.for("react.memo_cache_sentinel")?(O=(0,m.__)("Cancel","web-stories"),t[12]=O):O=t[12],t[13]===Symbol.for("react.memo_cache_sentinel")?(B=(0,m.__)("Delete","web-stories"),t[13]=B):B=t[13];const z="image"===i?C:q;let L,A,$;return t[14]!==z?(L=o.createElement(I.Text.Paragraph,{size:T.TextSize.Small},z),t[14]=z,t[15]=L):L=t[15],t[16]===Symbol.for("react.memo_cache_sentinel")?(A=o.createElement(I.Text.Paragraph,{size:T.TextSize.Small,isBold:!0},(0,m.__)("This action can not be undone.","web-stories")),t[16]=A):A=t[16],t[17]!==s||t[18]!==g||t[19]!==L||t[20]!==N?($=o.createElement(R.default,{isOpen:!0,onClose:s,title:N,secondaryText:O,onPrimary:g,primaryText:B,maxWidth:512},L,A),t[17]=s,t[18]=g,t[19]=L,t[20]=N,t[21]=$):$=t[21],$}function P(e){return{deleteElementsByResourceId:e.actions.deleteElementsByResourceId}}function j(e){const{actions:t}=e,{deleteMediaElement:n}=t;return{deleteMediaElement:n}}DeleteDialog.propTypes={mediaId:d().number.isRequired,type:d().string.isRequired,onClose:d().func.isRequired};const q=DeleteDialog;var N=n(41960),O=n(35382),B=n(99803),z=n(27510),L=n(48002);const A=(0,l.css)(["display:flex;width:","px;margin-right:28px;"],152),$=l.default.img.withConfig({displayName:"mediaEditDialog__Image",componentId:"sc-ctku7j-0"})(["",""],A),V=l.default.video.withConfig({displayName:"mediaEditDialog__Video",componentId:"sc-ctku7j-1"})(["",""],A),U=l.default.div.withConfig({displayName:"mediaEditDialog__DialogBody",componentId:"sc-ctku7j-2"})(["display:flex;justify-content:left;align-items:flex-start;"]),F=l.default.div.withConfig({displayName:"mediaEditDialog__MetadataTextContainer",componentId:"sc-ctku7j-3"})(["display:flex;flex-direction:column;margin:0 4px;"]),W=(0,l.default)(I.Text.Span).withConfig({displayName:"mediaEditDialog__DateText",componentId:"sc-ctku7j-4"})(["margin-bottom:8px;"]),G=(0,l.default)(L.default).withConfig({displayName:"mediaEditDialog__AssistiveTextArea",componentId:"sc-ctku7j-5"})(["margin:20px 0 4px;"]),H=(0,m.__)("Edit Image","web-stories"),X=(0,m.__)("Edit Video","web-stories"),Y=(0,m.__)("Assistive text","web-stories"),K=(0,m.__)("Video description","web-stories"),J=(0,m.__)("Describe the appearance and function of the image. Leave empty if the image is purely decorative.","web-stories"),Q=(0,m.__)("For indexability and accessibility. Include any burned-in text inside the video.","web-stories");function MediaEditDialog(e){const t=(0,a.c)(50),{resource:n,onClose:i}=e,{id:s,src:l,creationDate:c,width:d,height:u,type:p,alt:h,poster:f,mimeType:g}=n,{actions:y}=(0,M.useAPI)(),{updateMedia:b}=y,{updateMediaElement:_}=(0,S.useLocalMedia)(Z),{showSnackbar:E}=(0,k.useSnackbar)(),[w,C]=(0,r.useState)(h),x=(0,N.toDate)(c);let D,P;t[0]!==C?(D=e=>{C(e.target.value)},t[0]=C,t[1]=D):D=t[1],t[2]===Symbol.for("react.memo_cache_sentinel")?(P=[],t[2]=P):P=t[2];const j=(0,r.useCallback)(D,P);let q,z;t[3]!==w||t[4]!==s||t[5]!==i||t[6]!==E||t[7]!==b||t[8]!==_?(q=async()=>{try{await b(s,{altText:w}),_({id:s,data:{alt:w}}),i()}catch(e){const t=e;(0,v.trackError)("local_media_edit",t.message),E({message:(0,m.__)("Failed to update, please try again.","web-stories"),dismissible:!0})}},z=[w,s,i,E,b,_],t[3]=w,t[4]=s,t[5]=i,t[6]=E,t[7]=b,t[8]=_,t[9]=q,t[10]=z):(q=t[9],z=t[10]);const L=(0,r.useCallback)(q,z),A="image"===p,ee=R.default,te=A?H:X;let ne,oe;t[11]===Symbol.for("react.memo_cache_sentinel")?(ne=(0,m.__)("Cancel","web-stories"),t[11]=ne):ne=t[11],t[12]===Symbol.for("react.memo_cache_sentinel")?(oe=(0,m.__)("Save","web-stories"),t[12]=oe):oe=t[12];const ae=U;let re;t[13]!==h||t[14]!==g||t[15]!==f||t[16]!==n||t[17]!==l||t[18]!==p?(re="image"===p?o.createElement($,{src:(0,B.default)(152,n),alt:h,loading:"lazy",crossOrigin:"anonymous",decoding:"async"}):o.createElement(V,{key:l,crossOrigin:"anonymous",poster:f,preload:"metadata",muted:!0},o.createElement("source",{src:l,type:g})),t[13]=h,t[14]=g,t[15]=f,t[16]=n,t[17]=l,t[18]=p,t[19]=re):re=t[19];const ie=F,se=(0,N.isValid)(x)&&o.createElement(W,{size:T.TextSize.XSmall},(0,O.default)((0,m.__)("Uploaded: %s","web-stories"),(0,N.formatDate)(c)));let le,ce;t[20]!==u||t[21]!==d?(le=(0,O.default)((0,m.__)("%1$d x %2$d pixels","web-stories"),d,u),t[20]=u,t[21]=d,t[22]=le):le=t[22],t[23]!==le?(ce=o.createElement(I.Text.Span,{size:T.TextSize.Small},le),t[23]=le,t[24]=ce):ce=t[24];const de=A?Y:K,ue=A?Y:K;let me;t[25]!==w||t[26]!==j||t[27]!==de||t[28]!==ue?(me=o.createElement(G,{value:w,"aria-label":de,type:"text",placeholder:ue,onChange:j}),t[25]=w,t[26]=j,t[27]=de,t[28]=ue,t[29]=me):me=t[29];const pe=A?J:Q;let he,fe,ge,ye;return t[30]!==pe?(he=o.createElement(I.Text.Paragraph,{size:T.TextSize.Small},pe),t[30]=pe,t[31]=he):he=t[31],t[32]!==ie||t[33]!==se||t[34]!==ce||t[35]!==me||t[36]!==he?(fe=o.createElement(ie,null,se,ce,me,he),t[32]=ie,t[33]=se,t[34]=ce,t[35]=me,t[36]=he,t[37]=fe):fe=t[37],t[38]!==ae||t[39]!==re||t[40]!==fe?(ge=o.createElement(ae,null,re,fe),t[38]=ae,t[39]=re,t[40]=fe,t[41]=ge):ge=t[41],t[42]!==ee||t[43]!==i||t[44]!==ge||t[45]!==te||t[46]!==ne||t[47]!==oe||t[48]!==L?(ye=o.createElement(ee,{isOpen:true,onClose:i,title:te,secondaryText:ne,onPrimary:L,primaryText:oe},ge),t[42]=ee,t[43]=i,t[44]=ge,t[45]=te,t[46]=ne,t[47]=oe,t[48]=L,t[49]=ye):ye=t[49],ye}function Z(e){const{actions:t}=e,{updateMediaElement:n}=t;return{updateMediaElement:n}}MediaEditDialog.propTypes={resource:z.ResourcePropTypes.resource.isRequired,onClose:d().func.isRequired};const ee=MediaEditDialog,te=(0,l.default)(C.ActionButton).withConfig({displayName:"dropDownMenu__MoreButton",componentId:"sc-1eq0xdj-0"})(["top:4px;right:4px;"]),ne=l.default.div.withConfig({displayName:"dropDownMenu__DropDownContainer",componentId:"sc-1eq0xdj-1"})(["margin-top:10px;"]),oe=l.default.div.withConfig({displayName:"dropDownMenu__MenuContainer",componentId:"sc-1eq0xdj-2"})(["z-index:1;"]),ae=(0,l.css)(["min-width:160px;margin-top:0;li{display:block;}"]),re="edit",ie="delete";function DropDownMenu(e){const t=(0,a.c)(37),{resource:n,display:i,isMenuOpen:s,onMenuOpen:l,onMenuCancelled:c,onMenuSelected:d,setParentActive:u}=e,p=void 0===u?g.noop:u;let h;t[0]===Symbol.for("react.memo_cache_sentinel")?(h=[{options:[{label:(0,m.__)("Edit meta data","web-stories"),value:re},{label:(0,m.__)("Delete from library","web-stories"),value:ie}]}],t[0]=h):h=t[0];const f=h,[C,v]=(0,r.useState)(!1),[k,I]=(0,r.useState)(!1),T=(0,r.useRef)();let M,S;t[1]!==T.current||t[2]!==c||t[3]!==p?(M=()=>{c(),T.current?.focus(),p()},t[1]=T.current,t[2]=c,t[3]=p,t[4]=M):M=t[4],t[5]!==c||t[6]!==p?(S=[c,p],t[5]=c,t[6]=p,t[7]=S):S=t[7];const D=(0,r.useCallback)(M,S),{canTranscodeResource:R}=(0,w.useLocalMedia)(ce);let P;t[8]!==d||t[9]!==v||t[10]!==I?(P=(e,t)=>{d();e:switch(t){case re:I(!0);break e;case ie:v(!0)}},t[8]=d,t[9]=v,t[10]=I,t[11]=P):P=t[11];const j=P;let N,O;t[12]!==D||t[13]!==v?(N=()=>{v(!1),D()},O=[v,D],t[12]=D,t[13]=v,t[14]=N,t[15]=O):(N=t[14],O=t[15]);const B=(0,r.useCallback)(N,O);let z,L;t[16]!==D||t[17]!==I?(z=()=>{I(!1),D()},L=[I,D],t[16]=D,t[17]=I,t[18]=z,t[19]=L):(z=t[18],L=t[19]);const A=(0,r.useCallback)(z,L);let $;t[20]===Symbol.for("react.memo_cache_sentinel")?($=[],t[20]=$):$=t[20];const V=(0,r.useMemo)(le,$);let U;t[21]===Symbol.for("react.memo_cache_sentinel")?(U=[],t[21]=U):U=t[21];const F=(0,r.useMemo)(se,U);let W;return t[22]!==F||t[23]!==R||t[24]!==i||t[25]!==j||t[26]!==s||t[27]!==V||t[28]!==T||t[29]!==D||t[30]!==B||t[31]!==A||t[32]!==l||t[33]!==n||t[34]!==C||t[35]!==k?(W=R(n)&&o.createElement(oe,null,T.current&&o.createElement(x.default,{target:T.current}),o.createElement(te,{ref:T,onClick:l,"aria-label":(0,m.__)("More","web-stories"),"aria-pressed":s,"aria-haspopup":!0,"aria-expanded":s,"aria-owns":s?V:null,id:F,$display:i,tabIndex:i||s?0:-1},o.createElement(y.default,null)),(i||s)&&o.createElement(b.default,{anchor:T,placement:_.Placement.BottomStart,isOpen:s},o.createElement(ne,null,o.createElement(E.default,{parentId:F,listId:V,handleMenuItemSelect:j,groups:f,onDismissMenu:D,hasMenuRole:!0,menuStylesOverride:ae}))),C&&o.createElement(q,{mediaId:n.id,type:n.type,onClose:B}),k&&o.createElement(ee,{resource:n,onClose:A})),t[22]=F,t[23]=R,t[24]=i,t[25]=j,t[26]=s,t[27]=V,t[28]=T,t[29]=D,t[30]=B,t[31]=A,t[32]=l,t[33]=n,t[34]=C,t[35]=k,t[36]=W):W=t[36],W}function se(){return`button-${(0,f.default)()}`}function le(){return`list-${(0,f.default)()}`}function ce(e){const{state:t}=e,{canTranscodeResource:n}=t;return{canTranscodeResource:n}}DropDownMenu.propTypes={resource:d().object.isRequired,display:d().bool.isRequired,isMenuOpen:d().bool.isRequired,onMenuOpen:d().func.isRequired,onMenuCancelled:d().func.isRequired,onMenuSelected:d().func.isRequired,setParentActive:d().func};const de=DropDownMenu;var ue=n(15271),me=n(61951),pe=n(94165);const he=(0,l.default)(I.Text.Span).withConfig({displayName:"attribution__StyledText",componentId:"sc-dg18hp-0"})(["color:",";"],(({theme:e,active:t})=>(0,u.rgba)(e.colors.standard.white,t?1:.6))),fe=l.default.a.withConfig({displayName:"attribution__Link",componentId:"sc-dg18hp-1"})(["display:block;position:absolute;left:0;bottom:0;width:100%;padding:8px;background-color:",";text-overflow:ellipsis;overflow:hidden;white-space:nowrap;text-decoration:none;"],(({theme:e,active:t})=>(0,u.rgba)(e.colors.bg.primary,t?.8:.6))),ge=e=>{const t=(0,a.c)(13),{author:n,url:i}=e,[s,l]=(0,r.useState)(!1);let c;t[0]!==l?(c=()=>l(!0),t[0]=l,t[1]=c):c=t[1];const d=c;let u;t[2]!==l?(u=()=>l(!1),t[2]=l,t[3]=u):u=t[3];const m=u;let p,h;return t[4]!==n?(p=o.createElement(he,{size:T.TextSize.XSmall},n),t[4]=n,t[5]=p):p=t[5],t[6]!==s||t[7]!==n||t[8]!==d||t[9]!==m||t[10]!==p||t[11]!==i?(h=o.createElement(fe,{title:n,active:s,onPointerEnter:d,onFocus:d,onPointerLeave:m,onBlur:m,href:i,target:"_blank",rel:"noreferrer"},p),t[6]=s,t[7]=n,t[8]=d,t[9]=m,t[10]=p,t[11]=i,t[12]=h):h=t[12],h};var ye=n(1244),be=n(82003),_e=n(41134),Ee=n(77546),we=n(8985);function Ce(){return Ce=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)({}).hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},Ce.apply(null,arguments)}const xe=(0,l.css)(["width:100%;cursor:pointer;transition:0.2s transform,0.15s opacity;border-radius:4px;opacity:0;object-fit:cover;"]),ve=l.default.img.withConfig({displayName:"innerElement__Image",componentId:"sc-qkk7ov-0"})(["",""],xe),ke=l.default.video.withConfig({displayName:"innerElement__Video",componentId:"sc-qkk7ov-1"})([""," ",""],xe,(({showWithoutDelay:e})=>e?"opacity: 1;":"")),Ie=l.default.div.withConfig({displayName:"innerElement__DurationWrapper",componentId:"sc-qkk7ov-2"})(["position:absolute;bottom:8px;left:8px;background:",";border-radius:100px;height:18px;padding:0 6px;"],(({theme:e})=>e.colors.opacity.black64)),Te=l.default.div.withConfig({displayName:"innerElement__MuteWrapper",componentId:"sc-qkk7ov-3"})(["position:absolute;bottom:8px;right:8px;height:24px;width:24px;background:",";color:",";border-radius:100px;"],(({theme:e})=>e.colors.opacity.black64),(({theme:e})=>e.colors.fg.primary)),Me=(0,l.default)(I.Text.Span).attrs({size:T.TextSize.XSmall}).withConfig({displayName:"innerElement__Duration",componentId:"sc-qkk7ov-4"})(["color:",";display:block;"],(({theme:e})=>e.colors.fg.primary)),Se=l.default.img.withConfig({displayName:"innerElement__CloneImg",componentId:"sc-qkk7ov-5"})(["opacity:0;width:",";height:",";position:absolute;"],(({width:e})=>`${e}px`),(({height:e})=>`${e}px`));const De=(0,r.memo)((function InnerElement({type:e,src:t,resource:n,alt:a,width:i,height:s,onClick:l,onLoad:c=g.noop,showVideoDetail:d,mediaElementRef:u,active:m,isMuted:p}){const h=(0,r.useRef)(null),f=(0,r.useRef)(null),{handleDrag:y,handleDrop:b}=(0,Ee.useDropTargets)((({state:e,actions:t})=>({handleDrag:t.handleDrag,handleDrop:t.handleDrop,dropTargets:e.dropTargets,activeDropTargetId:e.activeDropTargetId})),((e,t)=>{if(f.current)return!1;if(null===f.current)return f.current=!1,!1;if(e?.dropTargets&&t?.dropTargets){const n=Object.keys(e.dropTargets),o=Object.keys(t.dropTargets);if(n.join()!==o.join())return!1}return e?.activeDropTargetId===t?.activeDropTargetId})),{setDraggingResource:_}=(0,Ee.useDropTargets)((({actions:{setDraggingResource:e}})=>({setDraggingResource:e})));let E;(0,r.useEffect)((()=>{n.poster&&(h.current=n.poster)}),[n.poster]);const{lengthFormatted:w,poster:C,mimeType:x}=n,v=C??h.current,k=v||(0,B.default)(i,n),I={width:i,height:s,alt:a,crossOrigin:"anonymous"},T={...I,onLoad:()=>{u.current&&(u.current.style.opacity=1),c()},loading:"lazy",decoding:"async",draggable:!1},M={...T,onLoad:void 0},D={...T,src:k},R={...I,title:a,alt:null,loop:e===S.ContentType.Gif,muted:!0,preload:"metadata",poster:v,showWithoutDelay:m};if(e===S.ContentType.Image||e===S.ContentType.Sticker?(E=o.createElement(ve,Ce({key:t},D,{ref:u})),M.src=k):[S.ContentType.Video,S.ContentType.Gif].includes(e)&&(E=o.createElement(o.Fragment,null,C&&!m?o.createElement(ve,Ce({key:t},D,{ref:u})):o.createElement(ke,Ce({key:t},R,{ref:u}),e===S.ContentType.Gif?n.output.src&&o.createElement("source",{src:n.output.src,type:n.output.mimeType}):o.createElement("source",{src:(0,B.default)(i,n),type:x})),e===S.ContentType.Video&&d&&w&&o.createElement(Ie,null,o.createElement(Me,null,w)),e===S.ContentType.Video&&d&&p&&o.createElement(Te,null,o.createElement(be.default,null))),M.src=C),!E)throw new Error("Invalid media element type.");const P=e===S.ContentType.Image?k:C;return o.createElement(o.Fragment,null,E,m&&o.createElement(we.default,{showIcon:!1}),o.createElement(_e.default,{active:m,handleDrag:e=>{f.current||(ye.default.set(n.id,{url:k,type:"cached"}),_(n),f.current=!0),y(n,e.clientX,e.clientY)},handleDragEnd:()=>{b(n),f.current=!1},type:n.type,elementProps:{resource:n},onClick:l(P),cloneElement:Se,cloneProps:M}))}));var Re=n(89912),Pe=n(65341),je=n(8192),qe=n(61007),Ne=n(43932),Oe=n(10710);const Be=l.default.div.withConfig({displayName:"insertionMenu__DropDownContainer",componentId:"sc-xjd4tf-0"})(["margin-top:10px;min-width:160px;"]),ze=l.default.div.withConfig({displayName:"insertionMenu__MenuContainer",componentId:"sc-xjd4tf-1"})(["z-index:1;"]),Le=(0,l.css)(["min-width:160px;margin-top:0;li{display:block;}"]),Ae="insert",$e="addBackground";function InsertionMenu(e){const t=(0,a.c)(53),{resource:n,display:i,onInsert:s,width:l,index:c,isLocal:d,setParentActive:u,setParentInactive:p}=e,h=void 0!==d&&d,f=void 0===u?g.noop:u,y=void 0===p?g.noop:p,w=(0,r.useRef)(),[x,v]=(0,r.useState)(!1);let k,I;t[0]!==v?(k=e=>{e.stopPropagation(),v(!0)},t[0]=v,t[1]=k):k=t[1],t[2]===Symbol.for("react.memo_cache_sentinel")?(I=[],t[2]=I):I=t[2];const T=(0,r.useCallback)(k,I);let M,S;t[3]!==w.current||t[4]!==v||t[5]!==f?(M=()=>{v(!1),w.current?.focus(),f()},t[3]=w.current,t[4]=v,t[5]=f,t[6]=M):M=t[6],t[7]!==f?(S=[f],t[7]=f,t[8]=S):S=t[8];const D=(0,r.useCallback)(M,S),{currentBackgroundId:R,combineElements:P}=(0,qe.default)(Fe),{type:j,poster:q}=n;let N;t[9]!==j?(N=["image","gif"].includes(j)?(0,m.__)("Insert image","web-stories"):(0,m.__)("Insert video","web-stories"),t[9]=j,t[10]=N):N=t[10];const O=N;let z,L,A;t[11]!==O?(z={label:O,value:Ae},t[11]=O,t[12]=z):z=t[12],t[13]===Symbol.for("react.memo_cache_sentinel")?(L={label:(0,m.__)("Add as background","web-stories"),value:$e},t[13]=L):L=t[13],t[14]!==z?(A=[{options:[z,L]}],t[14]=z,t[15]=A):A=t[15];const $=A;let V;t[16]!==P||t[17]!==R||t[18]!==s||t[19]!==q||t[20]!==n||t[21]!==v||t[22]!==y||t[23]!==l?(V=(e,t)=>{const o=q||(0,B.default)(l,n),a=(0,je.default)(n.type,{resource:n});v(!1);e:switch(t){case Ae:s(n,o);break e;case $e:P({firstElement:a,secondId:R})}y()},t[16]=P,t[17]=R,t[18]=s,t[19]=q,t[20]=n,t[21]=v,t[22]=y,t[23]=l,t[24]=V):V=t[24];const U=V;let F,W;t[25]!==w?(F={ref:w},t[25]=w,t[26]=F):F=t[26],t[27]===Symbol.for("react.memo_cache_sentinel")?(W=[],t[27]=W):W=t[27],(0,Ne.default)(F,W,3);const G=(0,Oe.default)();let H,X;t[28]!==G?(H=[G],t[28]=G,t[29]=H):H=t[29],(0,Re.useKeyDownEffect)(h?null:w,"tab",G,H),t[30]===Symbol.for("react.memo_cache_sentinel")?(X=[],t[30]=X):X=t[30];const Y=(0,r.useMemo)(Ue,X);let K;t[31]===Symbol.for("react.memo_cache_sentinel")?(K=[],t[31]=K):K=t[31];const J=(0,r.useMemo)(Ve,K);let Q;t[32]===Symbol.for("react.memo_cache_sentinel")?(Q=(0,m.__)("Open insertion menu","web-stories"),t[32]=Q):Q=t[32];const Z=x?Y:null,ee=0===c?0:-1;let te,ne,oe,ae;return t[33]===Symbol.for("react.memo_cache_sentinel")?(te=o.createElement(Pe.default,null),t[33]=te):te=t[33],t[34]!==J||t[35]!==i||t[36]!==w||t[37]!==x||t[38]!==T||t[39]!==Z||t[40]!==ee?(ne=o.createElement(C.ActionButton,{ref:w,onClick:T,"aria-label":Q,"aria-pressed":x,"aria-haspopup":!0,"aria-expanded":x,"aria-owns":Z,id:J,$display:i,tabIndex:ee},te),t[34]=J,t[35]=i,t[36]=w,t[37]=x,t[38]=T,t[39]=Z,t[40]=ee,t[41]=ne):ne=t[41],t[42]!==J||t[43]!==$||t[44]!==U||t[45]!==w||t[46]!==x||t[47]!==Y||t[48]!==D?(oe=x&&o.createElement(b.default,{anchor:w,placement:_.Placement.BottomStart,isOpen:x},o.createElement(Be,null,o.createElement(E.default,{parentId:J,listId:Y,handleMenuItemSelect:U,groups:$,onDismissMenu:D,hasMenuRole:!0,menuStylesOverride:Le}))),t[42]=J,t[43]=$,t[44]=U,t[45]=w,t[46]=x,t[47]=Y,t[48]=D,t[49]=oe):oe=t[49],t[50]!==ne||t[51]!==oe?(ae=o.createElement(ze,null,ne,oe),t[50]=ne,t[51]=oe,t[52]=ae):ae=t[52],ae}function Ve(){return`button-${(0,f.default)()}`}function Ue(){return`list-${(0,f.default)()}`}function Fe(e){return{currentBackgroundId:e.state.currentPage?.elements?.[0]?.id,combineElements:e.actions.combineElements}}InsertionMenu.propTypes={resource:z.ResourcePropTypes.resource.isRequired,display:d().bool.isRequired,onInsert:d().func.isRequired,width:d().number.isRequired,index:d().number.isRequired,isLocal:d().bool,setParentActive:d().func,setParentInactive:d().func};const We=InsertionMenu;function Ge(){return Ge=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)({}).hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},Ge.apply(null,arguments)}const He=l.default.div.attrs((e=>({style:{width:e.width+"px",height:e.height+"px",margin:e.margin,backgroundColor:"transparent",color:"inherit",border:"none",padding:0}}))).withConfig({displayName:"mediaElement__Container",componentId:"sc-n7038j-0"})([""]),Xe=l.default.div.withConfig({displayName:"mediaElement__InnerContainer",componentId:"sc-n7038j-1"})(["position:relative;display:flex;margin-bottom:10px;background-color:",";"],(({theme:e,$baseColor:t})=>t||(0,u.rgba)(e.colors.standard.black,.3))),Ye=(0,l.default)(h.Blurhash).withConfig({displayName:"mediaElement__BlurhashContainer",componentId:"sc-n7038j-2"})(["position:absolute !important;top:0;left:0;"]);function Element({index:e,resource:t,width:n,height:a,margin:i,onInsert:s,providerType:l,canEditMedia:c}){const{id:d,src:u,type:h,width:f,height:g,alt:y,isMuted:b,baseColor:_,blurHash:E}=t,{isCurrentResourceProcessing:w,isCurrentResourceUploading:C}=(0,S.useLocalMedia)((({state:e})=>({isCurrentResourceProcessing:e.isCurrentResourceProcessing,isCurrentResourceUploading:e.isCurrentResourceUploading}))),x=f&&g?f/g:1,v=n||a/x,k=a||v/x,I=(0,r.useRef)(),[T,M]=(0,r.useState)(!0),[D,R]=(0,r.useState)(!1),[P,j]=(0,r.useState)(!1),[q,N]=(0,r.useState)(!1),O=(0,r.useCallback)((()=>R(!0)),[]),B=(0,r.useCallback)((()=>R(!1)),[]),z=(0,r.useCallback)((()=>j(!0)),[]),L=(0,r.useCallback)((()=>j(!1)),[]),A=(0,r.useCallback)((()=>{j(!1),R(!1)}),[]),[$,V]=(0,r.useState)(null),U=(0,r.useRef)(D);U.current=D,(0,r.useEffect)((()=>{if(![S.ContentType.Video,S.ContentType.Gif].includes(h))return;const e=()=>{null!==$&&(clearTimeout($),V(null))};if(!P)if(D){if(M(!1),I.current&&null===$){const e=setTimeout((()=>{U.current&&u&&I.current.play().catch(me.noop)}),600);V(e)}}else M(!0),e(),I.current&&I.current?.pause&&u&&(I.current.pause(),I.current.currentTime=0);return e}),[P,D,h,u,$,V,U]);const F=(0,r.useCallback)((e=>()=>{s(t,e)}),[s,t]),W=D&&t.attribution?.author?.displayName&&t.attribution?.author?.url&&o.createElement(ge,{author:t.attribution.author.displayName,url:t.attribution.author.url}),G=(0,r.useRef)(),H=(0,r.useCallback)((()=>N(!0)),[]),X=!q&&!D;return o.createElement(He,{ref:G,"data-testid":`mediaElement-${h}`,"data-id":d,className:"mediaElement",width:v,height:k,margin:i,onPointerEnter:O,onFocus:O,onPointerLeave:B,onBlur:B,tabIndex:"-1"},o.createElement(Xe,{$baseColor:X&&_},o.createElement(De,{type:h,src:u,mediaElementRef:I,resource:t,alt:y,isMuted:b,width:v,height:k,onClick:F,onLoad:H,showVideoDetail:T,active:D}),W,X&&E&&o.createElement(pe.HideOnError,null,o.createElement(Ye,{hash:E,width:v,height:k,punch:1})),(!u||w(d)||C(d))&&o.createElement(p.LoadingBar,{loadingMessage:(0,m.__)("Uploading media…","web-stories")}),o.createElement(We,{resource:t,display:D,onInsert:s,width:v,index:e,isLocal:"local"===l,setParentActive:O,setParentInactive:B}),"local"===l&&c&&o.createElement(de,{resource:t,display:D,isMenuOpen:P,onMenuOpen:z,onMenuCancelled:L,onMenuSelected:A,setParentActive:O})))}function MediaElement(e){const t=(0,a.c)(13);let n,r,i;t[0]!==e?(({providerType:r,canEditMedia:i,...n}=e),t[0]=e,t[1]=n,t[2]=r,t[3]=i):(n=t[1],r=t[2],i=t[3]);const s=void 0===r?"local":r,l=void 0!==i&&i,{isCurrentResourceProcessing:c,isCurrentResourceUploading:d}=(0,S.useLocalMedia)(Ke),{id:u}=n.resource;if(c(u)||d(u)){let e,a;return t[4]===Symbol.for("react.memo_cache_sentinel")?(e=(0,m.__)("Uploading media…","web-stories"),t[4]=e):e=t[4],t[5]!==l||t[6]!==n||t[7]!==s?(a=o.createElement(ue.default,{title:e},o.createElement(Element,Ge({},n,{providerType:s,canEditMedia:l}))),t[5]=l,t[6]=n,t[7]=s,t[8]=a):a=t[8],a}let p;return t[9]!==l||t[10]!==n||t[11]!==s?(p=o.createElement(Element,Ge({},n,{providerType:s,canEditMedia:l})),t[9]=l,t[10]=n,t[11]=s,t[12]=p):p=t[12],p}function Ke(e){const{state:t}=e;return{isCurrentResourceProcessing:t.isCurrentResourceProcessing,isCurrentResourceUploading:t.isCurrentResourceUploading}}MediaElement.propTypes={index:d().number.isRequired,resource:d().object,width:d().number,height:d().number,margin:d().string,onInsert:d().func,providerType:d().string,canEditMedia:d().bool};const Je=(0,r.memo)(MediaElement);var Qe=n(1035);const Ze={maxPhotos:2},ContainerRenderer=e=>{const t=(0,a.c)(3),{children:n,containerRef:r}=e;let i;return t[0]!==n||t[1]!==r?(i=o.createElement(Qe.GalleryContainer,{ref:r},n),t[0]=n,t[1]=r,t[2]=i):i=t[2],i},RowRenderer=({children:e})=>e;function et(e,t){return{...e,index:t}}function tt(e){return{key:e.id,src:e.src,width:e.width,height:e.height,resource:e}}function nt(e){return{key:`uploading-${e.id}`,src:e.src,width:e.width,height:e.height,resource:e}}const ot=function MediaGallery(e){const t=(0,a.c)(13),{resources:n,uploadingResources:l,onInsert:c,providerType:d,canEditMedia:u}=e;let m;t[0]!==l?(m=void 0===l?[]:l,t[0]=l,t[1]=m):m=t[1];const p=m,h=void 0!==u&&u;let f;t[2]!==n||t[3]!==p?(f=[...p.map(nt),...n.map(tt)].map(et),t[2]=n,t[3]=p,t[4]=f):f=t[4];const g=f;let y,b;t[5]!==h||t[6]!==c||t[7]!==d?(y=e=>{const{photo:t,layout:n}=e;return o.createElement(Je,{key:t.key,index:t.index,margin:"0px 0px 8px 0px",resource:t.resource,width:n.width,height:n.height,onInsert:c,providerType:d,canEditMedia:h})},b=[d,c,h],t[5]=h,t[6]=c,t[7]=d,t[8]=y,t[9]=b):(y=t[8],b=t[9]);const _=(0,r.useCallback)(y,b);let E;return t[10]!==_||t[11]!==g?(E=o.createElement("div",null,o.createElement(i.default,{layout:"rows",photos:g,renderPhoto:_,renderRowContainer:RowRenderer,renderContainer:ContainerRenderer,targetRowHeight:110,rowConstraints:Ze,spacing:8,defaultContainerWidth:s.SIDEBAR_WIDTH})),t[10]=_,t[11]=g,t[12]=E):E=t[12],E}}}]);