document.addEventListener("DOMContentLoaded",function(){let e=document.querySelectorAll(".tp-form-block");0!==e.length&&e.forEach(e=>{let t,r,l,n={},a=null,o=null,i=!1,c=null,u=e.getAttribute("data-block-id");if(u){let s=e.querySelector(".nxt-form");n=s.getAttribute("data-formdata")||"";let d=e.querySelector(".nxt-country-dropdown");d&&(t=d.value,d.addEventListener("change",function(){t=this.value}));let x=e.querySelectorAll(".nxt-time-richtext, .nxt-date-richtext");x.forEach(e=>{let t=e.classList.contains("nxt-time-richtext")?"time":"date";e.addEventListener("click",e=>{e.target.type=t}),e.addEventListener("blur",e=>{e.target.type="text"})});let p=s.hasAttribute("data-actionoption")&&""!==s.getAttribute("data-actionoption").trim()?JSON.parse(s.getAttribute("data-actionoption")).map(e=>e.value):"",m=s.getAttribute("data-cap"),y="",h,f;if(p&&Array.isArray(p)){let b=p.some(e=>"redirect"===e.toLowerCase());b&&s.hasAttribute("data-redirect")&&(y=s.getAttribute("data-redirect")),b&&s.hasAttribute("data-link-blank")&&(h=s.getAttribute("data-link-blank")),b&&s.hasAttribute("data-link-nofollow")&&(f=s.getAttribute("data-link-nofollow"))}let q=e.querySelector(".nxt-secured-option");if(q){let S=q.getAttribute("data-security"),A=JSON.parse(S)||{};l=A.securityOptions,r=A.captchaOptions}let g=(e,t)=>{if(!e||!e.hasAttribute("data-required")||"false"===e.getAttribute("data-required"))return!0;let r=e.value.trim(),l=t.getAttribute("data-error-message");return r?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(r)?(t.textContent="",!0):(t.textContent=l||"Please enter a valid email address.",!1):(t.textContent=l||"This field is required.",!1)},v=(e,t)=>{if(!e||!e.hasAttribute("data-required")||"false"===e.getAttribute("data-required"))return!0;let r=e.value.trim(),l=t.getAttribute("data-error-message");return r?(t.textContent="",!0):(t.textContent=l||"This field is required.",!1)},E=(t,r)=>{if(!t||!t.hasAttribute("data-required")||"false"===t.getAttribute("data-required"))return!0;let l=!1;if("radio"===t.type){let n=e.querySelectorAll(`input[type="radio"][name="${t.name}"]`);l=Array.from(n).some(e=>e.checked)}else l=t.checked;let a="This field is required.";if(r&&"function"==typeof r.getAttribute){let o=r.getAttribute("data-error-message");o&&(a=o)}return l?(r&&(r.textContent=""),!0):(r&&(r.textContent=a),!1)},C=(e,t)=>{if(!e||!e.hasAttribute("data-required")||"false"===e.getAttribute("data-required"))return!0;let r=ea(e.value.trim()),l=t.getAttribute("data-error-message");return r?(t.textContent="",!0):(t.textContent=l||"This field is required.",!1)},$=(e,t)=>{if(!e||!e.hasAttribute("data-required")||"false"===e.getAttribute("data-required"))return!0;let r=/^(0?[0-9]|1[0-9]|2[0-3]):([0-5][0-9])$/.test(e.value.trim()),l=t?.getAttribute("data-error-message");return r?(t.textContent="",!0):(t.textContent=l||"This field is required.",!1)},k=(e,t)=>{if(!e||!e.hasAttribute("data-required")||"false"===e.getAttribute("data-required"))return!0;let r=/^\d{4}-(0[1-9]|1[0-2])-(0[1-9]|[12][0-9]|3[01])$/.test(e.value.trim()),l=t?.getAttribute("data-error-message");return r?(t.textContent="",!0):(t.textContent=l||"Invalid date format. Use YYYY-MM-DD.",!1)},_=(e,t)=>{if(!e)return t.textContent="",!0;let r=e.getAttribute("data-pattern"),l=e.value.trim(),n=t.getAttribute("data-error-message");if(e.hasAttribute("data-required")&&"false"!==e.getAttribute("data-required")&&!l)return t.textContent=n||"This field is required.",!1;if(l&&r&&"none"!==r){let a=RegExp(r);if(!a.test(l))return t.textContent=n||"Please enter a valid number.",!1}return l&&r&&"none"===r&&!/^[+]?[0-9\s\-()]+$/.test(l)?(t.textContent=n||"Please enter a valid phone number.",!1):(t.textContent="",!0)},L=e.querySelectorAll(".nxt-name-richtext"),w=e.querySelectorAll(".nxt-email-richtext"),j=e.querySelectorAll(".nxt-message-richtext"),T=e.querySelectorAll(".tp-form-checkbox-button"),P=e.querySelectorAll(".tp-form-radio-button "),O=e.querySelectorAll(".nxt-option-field"),Y=e.querySelectorAll(".nxt-url-richtext"),D=e.querySelectorAll(".nxt-number-richtext"),N=e.querySelectorAll(".nxt-time-richtext"),R=e.querySelectorAll(".nxt-date-richtext"),M=e.querySelectorAll(".nxt-phone-richtext"),z=e.querySelectorAll(".nxt-error-show"),I=e.querySelectorAll(".nxt-error-email"),U=e.querySelectorAll(".nxt-message-error");e.querySelectorAll(".nxt-error-checkbox"),e.querySelectorAll(".nxt-error-radiobox");let F=e.querySelectorAll(".nxt-error-select"),H=e.querySelectorAll(".nxt-error-number"),V=e.querySelectorAll(".nxt-error-url"),W=e.querySelectorAll(".nxt-error-time"),X=e.querySelectorAll(".nxt-error-date"),B=e.querySelectorAll(".nxt-error-phone");L.forEach((e,t)=>{e.addEventListener("input",()=>v(e,z[t]))}),w.forEach((e,t)=>{e.addEventListener("input",()=>g(e,I[t]))}),j.forEach((e,t)=>{e.addEventListener("input",()=>v(e,U[t]))}),T.forEach(e=>{let t=e.querySelectorAll('input[type="checkbox"]'),r=e.querySelector(".nxt-error-checkbox");t.forEach(e=>{e.addEventListener("change",()=>E(e,r))})}),P.forEach(e=>{let t=e.querySelectorAll('input[type="radio"]'),r=e.querySelector(".nxt-error-radiobox");t.forEach(e=>{e.addEventListener("change",()=>E(e,r))})}),O.forEach((e,t)=>{e.addEventListener("change",()=>v(e,F[t]))}),D.forEach((e,t)=>{e.addEventListener("input",()=>v(e,H[t]))}),Y.forEach((e,t)=>{e.addEventListener("input",()=>C(e,V[t]))}),N.forEach((e,t)=>{e.addEventListener("input",()=>$(e,V[t]))}),R.forEach((e,t)=>{e.addEventListener("input",()=>k(e,X[t]))}),M.forEach((e,t)=>{e.addEventListener("input",()=>_(e,B[t]))});let G=()=>{let e=!0,t=(t,r,l)=>{t.forEach((t,n)=>{if(t.hasAttribute("data-required")){let a=r(t,l[n]);e=e&&a}})};return t(L,v,z),t(w,g,I),t(j,v,U),t(O,v,F),t(D,v,H),t(Y,v,V),t(N,$,W),t(R,k,X),t(M,_,B),T.forEach(t=>{let r=t.querySelector('input[type="checkbox"]'),l=t.querySelector(".nxt-error-checkbox");if(r&&r.hasAttribute("data-required")){let n=E(r,l);e=e&&n}}),P.forEach(t=>{let r=t.querySelector('input[type="radio"]'),l=t.querySelector(".nxt-error-radiobox");if(r&&r.hasAttribute("data-required")){let n=E(r,l);e=e&&n}}),e};if("honeypot"===l){let J=s.querySelectorAll("input:not([type='submit']), textarea, select");J.forEach((e,t)=>{let r=document.createElement("div");r.style.display="none";let l=document.createElement("input");l.type="text",l.name=`honeypot_${t+1}`,l.className="nxt-honeypot-field",r.appendChild(l),e.insertAdjacentElement("afterend",r)})}let K=e.querySelector(".nxt-accept-richtext"),Q=e.querySelector(".nxt-submit-button");K&&(K.required?Q.disabled=!K.checked:Q.disabled=!1,K.addEventListener("change",()=>{K.required?Q.disabled=!K.checked:Q.disabled=!1}));let Z=e.querySelector(".nxt-form");Z&&(Z.addEventListener("submit",function e(t){if(t.preventDefault(),G()&&!i){if(i=!0,"honeypot"===l){let n=s.querySelectorAll(".nxt-honeypot-field"),o=!1;if(n.forEach(e=>{""!==e.value.trim()&&(o=!0)}),o){i=!1,eo("Form submission failed. Please try again.",!0);return}}if("recaptcha"===l){if("v3"===r)grecaptcha.ready(function(){grecaptcha.execute(m,{action:"submit"}).then(el)});else if("v2i"===r)grecaptcha.execute(a);else if("v2"===r){let u=grecaptcha.getResponse(a);u?el(u):(i=!1,eo("Please complete the reCAPTCHA.",!0))}else i=!1}else"cloudflare"===l?(c||et(),turnstile.reset(c),turnstile.execute(c)):en()}}),"recaptcha"===l?(t=>{let r=document.createElement("script");r.src="v3"===t?`https://www.google.com/recaptcha/api.js?render=${m}`:"https://www.google.com/recaptcha/api.js?onload=onRecaptchaLoadCallback&render=explicit",r.async=!0,r.defer=!0,e.appendChild(r),r.onload=()=>{"v3"===t&&grecaptcha.ready(()=>{})}})(r):"cloudflare"===l&&(()=>{let t=document.createElement("script");t.src="https://challenges.cloudflare.com/turnstile/v0/api.js?render=explicit",t.async=!0,t.defer=!0,e.appendChild(t),t.onload=()=>{}})());let ee=q&&q.hasAttribute("data-cloud")?q.getAttribute("data-cloud"):"",et=()=>{let t=e.querySelector("#recaptcha-container");t&&(c=turnstile.render(t,{sitekey:ee,callback:er}))},er=e=>{o=e,en()},el=e=>{o=e,en()},en=()=>{!function n(a){let c=new FormData,u=e=>{let r=[],l=e.type,n="",a="checkbox"===l?e.closest(".tp-form-checkbox-button")?.querySelector(".nxt-check-title-label"):"radio"===l?e.closest(".tp-form-radio-button")?.querySelector(".nxt-radio-title-label"):e.closest(".nxt-input-container")?.previousElementSibling||e.closest(".nxt-radio-box")?.querySelector("label")||e.closest(".nxt-time-input")?.querySelector(".nxt-time-label")||e.closest(".nxt-date-input")?.querySelector(".nxt-date-label")||e.closest(".nxt-option-container")?.querySelector(".nxt-option-label")||e.closest(".nxt-phone-input")?.querySelector(".nxt-phone-label")||e.closest(".nxt-message-input")?.querySelector(".nxt-message-label");if(n=a?a.innerText.trim():e.name,("radio"===l||"checkbox"===l)&&!e.checked)return r;let o=e.value||"";return"tel"===l&&t&&e.value&&(o=`${t} ${e.value}`),o&&r.push({label:n,value:o}),r},s=e.querySelectorAll(".nxt-form input:not([type='submit']), .nxt-form select, .nxt-form textarea"),d=Array.from(s),x=new Map;d.forEach(t=>{if("checkbox"===t.type){let r=t.name;if(!x.has(r)){let l=e.querySelectorAll(`input[name="${r}"]:checked`),n=Array.from(l).map(e=>e.value);if(n.length>0){let a=t.closest(".tp-form-checkbox-button")?.querySelector(".nxt-check-title-label")?.innerText.trim()||r;c.append(a,n.join(", "))}x.set(r,!0)}}else{let o=u(t);o.forEach(({label:e,value:t})=>{c.append(e,t)})}});let m=[...new Set(d.map(e=>e.name)),];m.forEach(t=>{let r=d.filter(e=>e.name===t),l=r.map(e=>u(e)).flat();if(l.length>0){let n=["Email","Auto Respond Email"];Array.isArray(p)&&p.some(e=>n.includes(e));let a=Array.isArray(p)&&p.some(e=>!n.includes(e));if(a){let o=p.some(e=>"webhook"===e.toLowerCase());if(o){let i={checkboxes:Array.from(e.querySelectorAll(".nxt-check-box")).filter(e=>e.id||e.querySelector(".nxt-check-label")?.textContent?.trim()||e.querySelector(".nxt-check-richtext")?.name).map(e=>({id:e.id||e.querySelector(".nxt-check-label")?.textContent?.trim()||e.querySelector(".nxt-check-richtext")?.name,value:Array.from(e.querySelectorAll('input[type="checkbox"]:checked')).map(e=>e.value).join(",")})),dates:Array.from(e.querySelectorAll(".nxt-date-richtext")).filter(e=>e.value&&(e.id||e.closest(".nxt-date-input")?.querySelector(".nxt-date-label")?.textContent?.trim()||e.name)).map(e=>({id:e.id||e.closest(".nxt-date-input")?.querySelector(".nxt-date-label")?.textContent?.trim()||e.name,value:e.value})),emails:Array.from(e.querySelectorAll(".nxt-email-richtext")).filter(e=>e.value&&(e.id||e.closest(".nxt-email-input")?.querySelector(".nxt-email-label")?.textContent?.trim()||e.name)).map(e=>({id:e.id||e.closest(".nxt-email-input")?.querySelector(".nxt-email-label")?.textContent?.trim()||e.name,value:e.value})),messages:Array.from(e.querySelectorAll(".nxt-message-richtext")).filter(e=>e.value&&(e.id||e.closest(".nxt-message-input")?.querySelector(".nxt-message-label")?.textContent?.trim()||e.name)).map(e=>({id:e.id||e.closest(".nxt-message-input")?.querySelector(".nxt-message-label")?.textContent?.trim()||e.name,value:e.value})),names:Array.from(e.querySelectorAll(".nxt-name-richtext")).filter(e=>e.value&&(e.id||e.closest(".nxt-name-input")?.querySelector(".nxt-name-label")?.textContent?.trim()||e.name)).map(e=>({id:e.id||e.closest(".nxt-name-input")?.querySelector(".nxt-name-label")?.textContent?.trim()||e.name,value:e.value})),numbers:Array.from(e.querySelectorAll(".nxt-number-richtext")).filter(e=>e.value&&(e.id||e.closest(".nxt-number-input")?.querySelector(".nxt-number-label")?.textContent?.trim()||e.name)).map(e=>({id:e.id||e.closest(".nxt-number-input")?.querySelector(".nxt-number-label")?.textContent?.trim()||e.name,value:e.value})),selects:Array.from(e.querySelectorAll(".nxt-option-container select")).filter(e=>e.value&&(e.closest(".nxt-option-container").id||e.closest(".nxt-option-container")?.querySelector(".nxt-option-label")?.textContent?.trim()||e.name)).map(e=>({id:e.closest(".nxt-option-container").id||e.closest(".nxt-option-container")?.querySelector(".nxt-option-label")?.textContent?.trim()||e.name,value:e.value})),phones:Array.from(e.querySelectorAll(".nxt-phone-richtext")).filter(e=>e.value&&(e.id||e.closest(".nxt-phone-input")?.querySelector(".nxt-phone-label")?.textContent?.trim()||e.name)).map(e=>{let t=e.previousElementSibling?.classList.contains("nxt-country-dropdown")?e.previousElementSibling:null,r="";return t&&"SELECT"===t.tagName&&(r=t.options[t.selectedIndex]?.value||""),{id:e.id||e.closest(".nxt-phone-input")?.querySelector(".nxt-phone-label")?.textContent?.trim()||e.name,value:(r?`${r} `:"")+e.value}}),radios:Array.from(e.querySelectorAll(".nxt-radio-box")).filter(e=>e.id||e.closest(".tp-form-radio-button")?.querySelector(".nxt-radio-title-label")?.textContent?.trim()||e.querySelector(".nxt-radio-richtext")?.name).map(e=>({id:e.id||e.closest(".tp-form-radio-button")?.querySelector(".nxt-radio-title-label")?.textContent?.trim()||e.querySelector(".nxt-radio-richtext")?.name,value:(e.querySelector('input[type="radio"]:checked')||{}).value||""})),times:Array.from(e.querySelectorAll(".nxt-time-richtext")).filter(e=>e.value&&(e.id||e.closest(".nxt-time-input")?.querySelector(".nxt-time-label")?.textContent?.trim()||e.name)).map(e=>({id:e.id||e.closest(".nxt-time-input")?.querySelector(".nxt-time-label")?.textContent?.trim()||e.name,value:e.value})),urls:Array.from(e.querySelectorAll(".nxt-url-richtext")).filter(e=>e.value&&(e.id||e.closest(".nxt-url-input")?.querySelector(".nxt-url-label")?.textContent?.trim()||e.name)).map(e=>({id:e.id||e.closest(".nxt-url-input")?.querySelector(".nxt-url-label")?.textContent?.trim()||e.name,value:e.value}))};Object.keys(i).forEach(e=>{i[e].forEach(e=>{console.log("field = ",e),c.append("nxt_"+e.id,e.value)})})}let s=l.map(e=>e.value).join(", ");c.append(`${t}-field`,s)}}});let b=new Map,q=e.querySelectorAll('input[type="radio"]:checked');if(q.forEach(e=>{let t=e.closest(".nxt-radio-box")?.querySelector(".nxt-radio-title-label"),r=t?.innerText.trim()||"radio-group";b.has(r)||b.set(r,[]),b.get(r).push(e.value)}),b.forEach((e,t)=>{let r=e.join(", ");c.append(t,r)}),c.append("actionOption",a||[]),c.append("action","nxt_form_action"),c.append("nonce",tpgb_config.tpgb_nonce),"recaptcha"===l||"cloudflare"===l?(c.append("captchaopt",r),c.append("securityValue",l),c.append("g-recaptcha-response",o||"")):c.append("captchaopt","none"),[{to:"emailto1",subject:"subject1",message1:"message1"},{subject:"subject2",message1:"message2"},].forEach((e,t)=>{let r=a[`emailTo${t+1}`],l=a[`subject${t+1}`],n=a[`message${t+1}`];r&&c.append(e.to,r),l&&c.append(e.subject,l),n&&c.append(e.message1,n)}),!p||0===p.length){eo("No form action is selected.",!0),i=!1;return}if(G()){if(p&&Array.isArray(p)&&!(1===p.length&&"redirect"===p[0].toLowerCase())){let S=e.querySelector(".nxt-submit"),A=S.querySelector(".nxt-loader"),g=S.querySelector(".nxt-button-svg"),v=S.querySelector(".nxt-btn-text");v&&(v.style.opacity="0"),g&&(g.style.opacity="0"),A.style.opacity="1",fetch(tpgb_config.ajax_url,{method:"POST",body:c,credentials:"same-origin",headers:{"X-WP-Nonce":tpgb_config.tpgb_nonce}}).then(e=>e.json()).then(t=>{if(i=!1,A.style.opacity="0",g&&(g.style.opacity="1"),v&&(v.style.opacity="1"),t.success){let r=e.querySelector(".nxt-success-message").getAttribute("data-success-message")||"Your submission was successful.";eo(r,!1);let l=e.querySelectorAll("input, textarea, select");l.forEach(e=>{"checkbox"===e.type||"radio"===e.type?e.checked=!1:e.value=""})}else{let n=t.data||"Unknown error occurred.";eo(n,!0),A.style.opacity="0",g&&(g.style.opacity="1"),v&&(v.style.opacity="1")}}).catch(e=>{A.style.opacity="0",g&&(g.style.opacity="1"),v&&(v.style.opacity="1"),eo("An error occurred while sending the form data.",!0),i=!1})}setTimeout(()=>{if(y&&ea(y)){if("1"===h){let e=window.open("","_blank");if("1"===f){let t=e.document.createElement("a");t.setAttribute("href",y),t.setAttribute("rel","nofollow"),e.document.body.appendChild(t),t.click()}else e.location.href=y}else window.location.href=y}},2e3)}}(n)},ea=e=>{try{return new URL(e),!0}catch(t){return!1}},eo=(t,r)=>{let l=e.querySelector(".nxt-success-message");l&&(l.textContent=t,l.classList.remove("nxt-success-message","nxt-error-message"),l.classList.add(r?"nxt-error-message":"nxt-success-message"),l.style.display="block")};window.onRecaptchaLoadCallback=function(){let t=e.querySelector("#recaptcha-container");if(t){if("v2i"===r){let l=e.querySelector("#recaptcha-container");l&&(a=grecaptcha.render("recaptcha-container",{sitekey:m,size:"invisible",callback:el}))}else if("v2"===r){let n=e.querySelector("#recaptcha-container");n&&(a=grecaptcha.render("recaptcha-container",{sitekey:m,size:"normal"}))}}}}})});